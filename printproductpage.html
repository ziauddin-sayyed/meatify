<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Printable Product Label</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #fff;
            margin: 0;
            padding: 0;
        }
    
        .category-section {
            margin-bottom: 2rem;
        }
    
        .category-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            color: #333;
            border-bottom: 2px solid #ddd;
            display: inline-block;
            padding-bottom: 2px;
        }
    
        .product-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
    
        .product-card {
            width: 50mm;
            height: 30mm;
            padding: 6px 8px;
            margin: 6px;
            font-size: 0.85rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: #fff;
            box-sizing: border-box;
        }
    
        .product-name {
            font-weight: 600;
            color: #222;
        }
    
        .product-qty {
            font-size: 0.7rem;
            /* font-weight: bold; */
        }
    
        .product-price {
            color: #000;
        }
    
        .use-by {
            font-size: 0.7rem;
        }
    
        .use-by small {
            /* color: #e63946; */
            font-weight: 600;
        }
    
        /* âœ… PRINT MODE â€” one product per page, centered */
        @media print {
            body {
                margin: 0;
                padding: 0;
                background: #fff;
            }
    
            .category-section,
            .category-title {
                display: none;
                /* Hide headings during print */
            }
    
            .product-grid {
                display: block;
            }
    
            .product-card {
                page-break-after: always;
                width: 55mm;
                height: 33mm;
                display: flex;
                margin-left: 3mm;
                margin-top: 0mm;
                transform: none;
                box-sizing: border-box;
                position: relative;
            }
    
            /* ðŸ§­ Perfect centering on page */
            @page {
                size: 55mm 33mm;
                margin: 0;
            }
    
    
        }
    </style>
</head>

<body>
    <div id="productContainer">Loading product...</div>

    <script>
        const graphqlEndpoint = 'https://api.meatify.in/graphql/';

        const query = `
    query GetProduct {
      products(first: 1, channel: "in") {
        edges {
          node {
            id
            name
            description
            category { name }
            attributes { attribute { name slug } values { name } }
            variants {
              name
              attributes { attribute { name slug } values { name } }
            }
            pricing { priceRange { start { gross { amount currency } } } }
          }
        }
      }
    }`;

        async function fetchProduct() {
            const res = await fetch(graphqlEndpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ query }),
            });
            const json = await res.json();
            return json.data.products.edges[0].node;
        }

        function renderProduct(product) {
            const container = document.getElementById("productContainer");
            container.innerHTML = "";

            const price = product.pricing?.priceRange?.start?.gross?.amount || 0;
            const variant = product.variants?.[0];
            const netWeight =
                product.attributes?.find((a) => a.attribute.slug === "net-weight")?.values?.[0]?.name ||
                variant?.attributes?.find((a) => a.attribute.slug === "net-weight")?.values?.[0]?.name ||
                "";

            const netWeightText = netWeight || "";
            const numericWeight = parseFloat(netWeightText.replace(/[^\d.]/g, "")) || 0;

            let pricePerGram = 0;
            if (numericWeight > 0 && price > 0) {
                pricePerGram = price / numericWeight;
            }

            // âœ… Future date (2 days ahead, IST)
            const today = new Date();
            today.setDate(today.getDate() + 2);
            const options = { day: 'numeric', month: 'long', year: 'numeric', timeZone: 'Asia/Kolkata' };
            const futureDateText = today.toLocaleDateString('en-IN', options);

            // âœ… Create product card (SINGLE)
            const card = document.createElement("div");
            card.className = "product-card";
            card.innerHTML = `
        <div class="product-name">${product.name}</div>
        <div class="product-price">MRP â‚¹ <span style="font-weight:bold;">${price.toFixed(2)}</span></div>
        <div class="use-by">Use by: <small>${futureDateText}</small></div>
        ${netWeightText ? `<div class="product-qty"><span>Net Weight:</span> <span style="font-weight:bold; font-size:14px">${netWeightText}</span></div>` : ""}
        <div style="font-size:0.7rem;">USP: Rs ${pricePerGram.toFixed(2)}${pricePerGram > 0 ? "/g" : ""}</div>
      `;

            container.appendChild(card);
        }

        async function init() {
            const product = await fetchProduct();
            renderProduct(product);
        }

        init();
    </script>
</body>

</html>